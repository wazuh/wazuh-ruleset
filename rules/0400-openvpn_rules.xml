<!--
  -  OpenVPN rules
  -  Author: Julio Camargo <julio.camargo@trustux.com.br>
  -  Updated by Wazuh, Inc.
  -  Copyright (C) 2015-2019, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!-- ID: 81800 - 81899 -->

<group name="openvpn,">
    <rule id="81800" level="0">
        <decoded_as>openvpn</decoded_as>
        <description>OpenVPN messages grouped.</description>
    </rule>

    <!--
    Jul 21 18:31:19 fw01 openvpn[76395]: 200.200.200.200:17777 [chapolin] Peer Connection Initiated with [AF_INET]200.200.200.200:17777
    -->
    <rule id="81801" level="3">
        <if_sid>81800</if_sid>
        <match>Peer Connection Initiated with</match>
        <description>OpenVPN: User logged in</description>
        <group>authentication_success,pci_dss_10.2.5,gpg13_7.1,gpg13_7.2,gdpr_IV_32.2,</group>
    </rule>

    <rule id="81802" level="3" frequency="3" timeframe="60">
        <if_matched_sid>81801</if_matched_sid>
        <user />
        <options>alert_by_email</options>
        <description>OpenVPN: Concurrent connections</description>
    </rule>

    <!--
    Jul 22 11:46:19 fw01 openvpn[43658]: 201.201.201.201:1194 TLS Auth Error: Auth Username/Password verification failed for peer
    Jul 22 13:10:29 fw01 openvpn[76395]: girafalez/202.202.202.202:1194 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
    Jul 22 13:10:29 fw01 openvpn[76395]: girafalez/202.202.202.202:1194 TLS Error: TLS handshake failed
    -->
    <rule id="81803" level="4">
        <if_sid>81800</if_sid>
        <match>TLS Error|TLS Auth Error</match>
        <description>OpenVPN: Connection Certificate Failed</description>
        <group>openvpn-error,gdpr_IV_35.7.d,</group>
    </rule>

    <rule id="81804" level="4" frequency="3" timeframe="60">
        <if_matched_sid>81803</if_matched_sid>
        <options>alert_by_email</options>
        <description>OpenVPN: Certificate failed - Possible revoked user</description>
        <group>openvpn-error,gdpr_IV_35.7.d,gdpr_IV_32.2,</group>
    </rule>

</group>
